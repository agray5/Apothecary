<!<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Title of the document</title>
	<link href="main.css" rel="stylesheet" type="text/css">
	<!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css"rel="stylesheet">-->
	<link href="bootstrap-3.3.7-dist/css/bootstrap.min.css"rel="stylesheet">
	<link href=
	"https://fonts.googleapis.com/css?family=Fanwood+Text|Lovers+Quarrel|Slabo+27px"
	rel="stylesheet">
	<script src=
	"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
	</script>
	<script language="javascript" src="main.json" type="text/javascript">
	</script>
	<script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js">
	</script>
	<!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js"></script>-->
	<script src="bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
	<script src="main.js">
	</script>
</head>
<body>
	<div id="roam">
		<div class="inv">
			Inventory
			<ul>
				<li></li>
			</ul>
		</div>
		<div class="main">
			<h1><span id="roomName">Room Name</span></h1>
			<ul class="exit"></ul>
			<div id="npcCutOut"></div>
			<div class="bottomOfScreen" id="bottomText">
				<div id="nameBox"><span id="nameBoxText">Name</span></div>
				<div class="textBox">
					<div class="left" id="playerAvatar"><img src=
					"img/playerBase.png"></div><br>
					<span id="text">text</span>
				</div>	
					<span class="glyphicon glyphicon-resize-full" id="resizeBtn"></span>
			</div>
			<div class="action">
					<ul >
						<li>
							<a href="#">Action 1</a>
						</li>
						<li>
							<a href="#">Action 2</a>
						</li>
					</ul>
				</div>
		</div>
		<div class="info">
			<ul>
				<li>Name: <span class="Playername">Aeith</span></li>
				<li>Munny: <span class="munny">0</span></li>
				<li>Time: <span id="time">Morning</span></li>
				<li>
					<a href="#" onclick="openJournal()">Journal</a>
				</li>
			</ul>
		</div>
	</div>
	<div id="ingShop">
		<div class="ingBackground"></div>
		<div id="ingShopBorder">
			<div class="borderM" id="buyM">
				<div class="buym_">
					Buy
				</div>
				<div class="buym_">
					Sell
				</div>
				<div class="buym_" id="buy_exit">
					Exit
				</div>
			</div>
			<div class="borderM" id="munM">
				<span class="munny">0</span> <span class="emph">M</span>
			</div>
			<div class="borderM" id="shopM">
				<table id="buyTable"></table><span id="buyTotalText">Total: <span id=
				"buyTotalAmount">0</span><button class="myBtn" id=
				"IngBuyButton">Buy</button></span>
			</div>
			<div class="borderM" id="infoM">
				Info
			</div>
		</div>
	</div>
	<div class="overlay" id="journal">
		<div class="ribbon">
			<a class="closebtn" href="javascript:void(0)" onclick=
			"closeJournal()">&times;</a>
		</div>
		<div class="journal-content">
			<div id="jOptions">
				<ul class="tab">
					<li class="ribbonHoz">
						<a class="tablinks" href="javascript:void(0)" id="defaultOpen" onclick=
						"openTab('Equipment')"><span class="content">Equipment</span></a>
					</li>
					<li class="ribbonHoz">
						<a class="tablinks" href="javascript:void(0)" onclick=
						"openTab('Inventory')"><span class="content">Inventory</span></a>
					</li>
					<li class="ribbonHoz">
						<a class="tablinks" href="javascript:void(0)" onclick=
						"openTab('Ingredients')"><span class="content">Ingredients</span></a>
					</li>
					<li class="ribbonHoz">
						<a class="tablinks" href="javascript:void(0)" onclick=
						"openTab('Recipes')"><span class="content">Recipes</span></a>
					</li>
				</ul>
			</div>
			<div id="jContent">
				<div class="tabcontent" id="Equipment">
					<h3 style="margin-bottom: 10px;">Equipment</h3>
					<div class="left" id="equipmentChest">
						<div></div>
						<div></div>
						<div></div>
						<div></div>
						<div></div>
						<div></div>
						<div></div>
						<div></div>
						<div></div>
						<div></div>
						<div></div>
						<div></div>
					</div>
					<div class="vcontainer right">
						<div id="playerEquipped">
							<div class="vcontainer">
								<div class="equippedBox" id="shirtE">
									shirt
								</div>
								<div class="equippedBox" id="handLE">
									left hand
								</div>
								<div class="equippedBox" id="hatE">
									hat
								</div>
							</div>
							<div class="vcontainer">
								<div id="playerBase">
									<img src="img/playerBase.png">
									<div id="playerHat"></div>
									<div id="playerShirt"></div>
									<div id="playerHandL"></div>
									<div id="playerPants"></div>
									<div id="playerHandR"></div>
									<div id="playerShoes"></div>
								</div>
							</div>
							<div class="vcontainer">
								<div class="equippedBox" id="pantsE">
									pants
								</div>
								<div class="equippedBox" id="handRE">
									right hand
								</div>
								<div class="equippedBox" id="shoesE">
									shoes
								</div>
							</div>
						</div>
						<div class="borderM" id="equipInfo">
							Info
						</div>
					</div>
					<div class="clearfix"></div>
				</div>
				<div class="tabcontent" id="Inventory">
					<h3>Inventory</h3>
					<table id="invTable"></table>
				</div>
				<div class="tabcontent" id="Ingredients">
					<h3>London</h3>
					<p>London is the capital city of England.</p>
				</div>
				<div class="tabcontent" id="Recipes">
					<h3>Recipes</h3>
					<div class="arrow-left" id="recL"></div>
					<div id="recipeInfo">
						<div class="equippedBox" id="recIcon"><!-- Replace Image --><img height=
						"150px" src="img/potion.png" width="150px"></div><span id="recName">Basic
						Health Potion</span><br>
						<br>
						<span style="color:gold; margin-left: 5px">Base Value:</span> <span id=
						"recValue">10</span> <span style="color:gold">Mun</span>
					</div>
					<div id="recipeDisplay">
						<span id="recDesc">I am the potion description such as: weak healing
						potion with mild stamina regen effect.</span>
						<h4 style="color:gold;">Favorite of:</h4>
						<ul id="recFav">
							<li><img src="img/char.jpg">Asuno</li>
							<li><img src="img/garra.jpg">Gaara</li>
						</ul>
					</div>
					<div class="arrow-right" id="recR"></div>
				</div>
			</div>
		</div>
	</div>
	<div id="mainMenu">
		<img src="img/m.jpg" width="100%" height="100%">
		<span class="cBtn" id="NewGameBtn"> New Game </span>
		<span class="cBtn" id="LoadGameBtn"> Load Game </span>
		<span class="cBtn" id="OptionsBtn"> Options </span>
		<span class="cBtn" id="CreditsBtn"> Credits </span>
	</div>
	<div id="startNewGame">
		<div id="newGameBoard">
			<span id="newGameText">New Game</span>
			<div id="boardPaper">
				<span class="textWBkg" style="top: 50px"><br>Welcome to the demo of Apothecary. Art assets are not final and most are likely to change.</span>
				<span class="textWBkg"><br>For years you had trained with the local herbalist learning to create a wide array of medicines. They were training you to become the next village 
				healer, but it soon became clear that you were gifted in both brewing potions and mixing medical herbs. Over the years word spread of your medicine's potency and many would travel miles for your aid.
				News of your works spread as far as the capital. One day the royal guard showed in your home village and "requested" that you move to the castle in the capital, so that your services could be put to use there. 
				You said your goodbyes to your family, feeling a mix of emotions, and headed out with the guard toward your new home.
				</span>
				<span class="textWBkg" style="top: 150px; float: left;">Player Name: </span>
				<div class="field" id="nameform"> 
					<input type="text" id="nameterm" placeholder="Name" />
					<button type="button" id="nameEnter">Enter</button>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
 <script>

		/********** Object Constructors ***********/
		function Item(name, id, desc, inRoomDesc, value, type, subType, sprite, isTakeable, isExaminable, isEdible) {
		    this.invCount = 0;
		    this.name = name;
		    this.id = id;
		    this.inRoomDesc = inRoomDesc;
		    this.value = value;
		    this.type = type;
			this.subType = subType;
			this.sprite = sprite;
		    this.isTakeable = isTakeable;
		    this.isExaminable = isExaminable;
		    this.desc = desc;
		    this.isEdible = isEdible;
		    if (isTakeable == null) {
		        this.isTakeable = false;
		    }
		    if (isExaminable == null) {
		        this.isExaminable = false
		    }
		    if (isEdible == null) {
		        this.isEdible = false;
		    }
		    if (value == null) {
		        value = 0;
		    }
		}

		function Room(name, bkg, initDesc, morningDesc, noonDesc, eveningDesc, nightDesc,  isOutside, npcs, takeableItems, examinableItems) {
			hasSeen = false;
		    savedText = [];
			this.bkg = bkg;
		    exits = [];
		    this.name = name;
			this.initDesc = initDesc;
		    this.morningDesc = morningDesc;
			this.noonDesc = noonDesc;
			this.eveningDesc = eveningDesc;
			this.nightDesc = nightDesc;
		    this.npcs = npcs;
		    this.takeableItems = takeableItems;
		    this.examinableItems = examinableItems;
		    this.isOutside = isOutside;
		    if (npcs == null) {
		        this.npcs = [];
		    }
		    if (takeableItems == null) {
		        this.takeableItems = [];
		    }
		    if (examinableItems == null) {
		        this.examinableItems = [];
		    }
		    if (isOutside == null) {
		        this.isOutside = false;
		    }
		}

		Room.prototype.addExits = function(exits) {
		    this.exits = exits;
		}
		
		function Exit(dir, nextRoom, exitMsg) {
		    this.dir = dir;
		    this.nextRoom = nextRoom;
		    this.exitMsg = exitMsg;
		    if (exitMsg == null) {
		        this.exitMsg = null;
		    }
		}

		function Actor(name, startState, cutOut){
			this.name = name;
			this.startState = startState;
			this.cutOut = cutOut;
			states = [];
			convoNode = [];
			startState;
		}
		
		function State(pages){
			this.pages = pages;
		}

		/********** Varibles ***********/
		var name = "Megiath";
		var gender = "female";
		//holds inventory items
		var inventory = [];
		var ingChest = [];
		var equipped = [];
		var equipment = [];
		var currentRoom;
		var munny = 0;
		var clock = 600;
		var timeOfDay = "morning";
		var rate = .5;
		var turns = 0;
		var isOutside = false;
		var N = "North";
		var S = "South";
		var E = "East";
		var W = "West";
		var NE = "NorthEast";
		var NW = "NorthWest";
		var SE = "SouthEast";
		var SW = "SouthWest";
		var ingShopCat = [];
		var resizeToggle = false;
		var talking = false;
		var state;
		var currentPage = 0;

		/********** Functions ***********/

		/* Handle Room as it appears on the page*/

		var updateRoomName = function(name) {
		    $("#roomName").text(name);
		};

		var addText = function(text) {
		    $(".textBox").append('<p>' + text + '</p>');
		};

		var flushTextBox = function() {
		    $("ul.exit").empty();
		    $(".textBox").empty();
		    $(".action ul").empty();
		};

		var addExits = function(exits) {
		    for (let e of exits) {
		        $("ul.exit").append('<li id="' + e.dir + '"><a href="#">' + e.dir + '</li>');
		    }
		};

		var removeExits = function(exits) {
		    for (let e of exits) {
		        var str = "#" + e.dir;
		        $(str).remove();
		    }
		};

		var addActionsBasedOnCurrRoom = function() {
			if(!talking){
				if (typeof currentRoom.npcs != "undefined" && currentRoom.npcs !== null && currentRoom.npcs.length > 0) {
					$(".action ul").append('<li id="talk"><a href="#">Talk To</li>');
				}
				if (typeof currentRoom.takeableItems != "undefined" && currentRoom.takeableItems !== null && currentRoom.takeableItems.length > 0) {
					$(".action ul").append('<li id="take"><a href="#">Take</li>');
				}
				if (typeof currentRoom.examinableItems != "undefined" && currentRoom.examinableItems !== null && currentRoom.examinableItems.length > 0) {
					$(".action ul").append('<li id="examine"><a href="#">Examine</li>');
				}
				$(".action ul").append('<li id="look"><a href="#">Look Around</li>');
				if (currentRoom == ingredientshop) 
					$(".action ul").append('<li id="shop"><a href="#">Shop</li>');
			}
			else{
			}
		};
		
		var addAction = function(id, name){
			$(".action ul").append('<li id="'+id+'"><a href="#">'+name+'</li>');
		}
		var removeAction = function(id){
			$(".action #"+id).remove();
		}

		var displayItemsInRoom = function() {
		    if (currentRoom.takeableItems != null && currentRoom.takeableItems.length > 0) {
		        for (let i of currentRoom.takeableItems) {
		            addText('\n <span class="inTextBox" id="' + i.id + '">' + i.inRoomDesc + "</span>");
		        }
		    }

		};


		//based on current room, proper room connecter
		var changeRoom = function(exit) {
		    takeTurn();
			$(".main").css("background", "url("+currentRoom.bkg+") center center/ cover no-repeat ");
		    if (currentRoom.isOutside) {
		        isOutside = true;
		    }
		    currentRoom.savedText = [];
		    refreshRoom(exit);
			if(!currentRoom.hasSeen)
				currentRoom.hasSeen = true;
		};

		//only to refresh the room's state
		var refreshRoom = function(exit) {
		    flushTextBox();
		    updateRoomName(currentRoom.name);
		    if (exit != null) {
		        addText(exit.exitMsg);
		    }
			if(!currentRoom.hasSeen && !(currentRoom.initDesc == null)){
				 addText(currentRoom.initDesc);
			}
			else{
				switch(timeOfDay){
					case "morning": 
						addText(currentRoom.morningDesc); break;
					case "noon":
						if(currentRoom.noonDesc == null)
							addText(currentRoom.morningDesc);
						else
							addText(currentRoom.noonDesc);
						break;
					case "evening":
						if(currentRoom.eveningDesc == null)
							addText(currentRoom.morningDesc);
						else
							addText(currentRoom.eveningDesc);
						break;
					case "night":
						if(currentRoom.nightDesc == null)
							addText(currentRoom.morningDesc);
						else
							addText(currentRoom.nightDesc);
						break;
				}
			}		
		    displayItemsInRoom();
		    addExits(currentRoom.exits);
		    addActionsBasedOnCurrRoom();
		};
		//used if we only want to refersh actions
		var refreshActions = function() {
		    $(".action ul").empty();
		    addActionsBasedOnCurrRoom();
		};



		/* Inventory*/

		var addInv = function(item) {
		    console.log("adding: " + item.name);
		    if (item.invCount <= 0) {
		        inventory.push(item);
		        $(".inv ul").append("<li id=\"" + item.id + "\"><a class='pop' data-content='" + getInvLinks(item.id) + "'  data-toggle='popover' href='#' title='' data-original-title rel='popover'><span class='itemText'>" + item.name + '</span></a></li>');
		        $(".pop").popover({
		                trigger: "manual",
		                html: true,
		                animation: false,
		                placement: 'right',
		                container: 'body',
		            })
		            .on("mouseenter", function() {
						if(!talking){
						var _this = this;
		                $(this).popover("show");
		                $(".popover").on("mouseleave", function() {
		                    $(_this).popover('hide');
		                });
						}
		            }).on("mouseleave", function() {
		                var _this = this;
		                setTimeout(function() {
		                    if (!$(".popover:hover").length) {
		                        $(_this).popover("hide");
		                    }
		                }, 30);
		            });
		    } else {
		        var str = "#" + item.id + " .itemText";
		        $(str).text("" + item.name + " x " + (item.invCount + 1));
		    }
		    item.invCount++;
		};

		var removeInv = function(item) {
		    item.invCount--;
		    if (item.invCount <= 0) {
		        var index = inventory.indexOf(item);
		        $('.pop').popover('hide');
		        if (index != -1) {
		            inventory.splice(index, 1);
		        }
		        var str = "#" + item.id;
		        $(str).remove();
		    } else {
		        if (item.invCount == 1) {
		            var str1 = "#" + item.id + " .itemText";
		            $(str1).text(item.name);
		        } else {
		            var str1 = "#" + item.id + " .itemText";
		            $(str1).text("" + item.name + " x " + (item.invCount + 1));
		        }
		    }
		};
		//fix string
		var dropItem = function(item) {
		    for (let i of inventory) {
		        if (i.id == item) {
		            removeInv(i);
		            if (currentRoom.takeableItems == null) {
		                console.log("currentRoom.takeableItems is null");
		            }
		            currentRoom.takeableItems.push(i);
		            refreshActions();
		            lookAround();
					//scrollText();
		        }
		    }
		};

		var takeItem = function(item) {
			if(item.type == "equip")
				equipment.push(item);
			else
				addInv(item);
		    var index = currentRoom.takeableItems.indexOf(item);
		    if (index != -1) {
		        currentRoom.takeableItems.splice(index, 1);
		    }
		    var str = "#" + item.id + ".inTextBox";
		    $(str).remove();
		    var str = "#" + item.id + ".takeable";
		    $(str).remove();
		};

		var getInvLinks = function(id) {
		    var obj = null;
		    for (let o of inventory) {
		        if (o.id == id) {
		            obj = o;
		        }
		    }
		    var str = '';
		    if (obj.isEdible) {
		        str += '<a id=&quot;eat&quot; href=&quot;#&quot;>Eat</a><br>';
		    }
		    str += '<a id=&quot;examine&quot; href=&quot;javascript:examine(' + obj.id + ')&quot;>Examine</a><br>';
		    str += '<a d=&quot;drop&quot; href=&quot;javascript:dropItem(' + obj.id + ')&quot;>Drop</a>';
		    return str;
		};

		/* Munny */

		var addMunny = function(amount) {
		    munny += amount;
		    $(".munny").text(munny);
		};

		var subMunny = function(amount) {
		    munny -= amount;
		    $(".munny").text(munny);
		};

		/* Back Action */
		var menuBack = function() {
		    $(".action ul").empty();
		    addActionsBasedOnCurrRoom();
		};

		/* Time */

		var turnsToTime = function() {
		    var rateXturns = rate * turns;
		    var hour = Math.floor(rateXturns) * 100;
		    var minutes = Math.floor((rateXturns % 1) * 100);
		    if (minutes < 60) {
		        var extractHours = minutes / 60;
		        var tmpHours = Math.floor((extractHours));
		        hour += tmpHours * 100;
		        minutes = Math.floor((extractHours % 1) * 100);
		    }
		    clock = hour + minutes;
		}

		var takeTurn = function() {
		    //take a turn when soing a action or leaving a room
		    var oldTime = timeOfDay;
		    turns++;
		    turnsToTime();
		    if (clock >= 2400) {
		        turns = 0;
		        clock = 0;
		    } else if (clock >= 2200) {
		        timeOfDay = "night";
		    } else if (clock >= 1800) {
		        timeOfDay = "evening";
		    } else if (clock >= 1200) {
		        timeOfDay = "noon";
		    } else if (turns >= 600) {
		        timeOfDay = "morning";
		    }
		    if (time != oldTime) {
		        $("#time").text(timeOfDay);
		    }
		};

		/* Ingredient Shop */

		$("#buy_exit").on("click", function(event) {
			$("#buyTable").empty();
		    $("#roam").toggle();
		    $("#ingShop").toggle();
		    //$(".ingBackground").toggle();
		});

		var loadShopMenu = function() {
		    for (let i of ingShopCat) {
		        $("#buyTable").append('<tr id=' + i.id + 'BM><td>' + selectIcon(i.type) + "  " + i.name + '</td><td>' + i.value + '</td><td>X</td><td><span class="buyAmount"><button class="up" onclick="javascript:setQuantity(\'up\',' + i.id + ',' + i.value + ')">+</button>' +
		            '<input type="text" value="0" style="width: 20px"><button class="down" onclick="javascript:setQuantity(\'down\',' + i.id + ',' + i.value + ')">-</button></span></td><td><span class="buyItemTotal">0</td></tr>');
		    }
		}

		var setQuantity = function(upordown, id, cost) {
		    var str = '#' + id + 'BM input';
		    var str2 = '#' + id + 'BM .buyItemTotal';
		    var value = parseInt($(str).val());
		    var total = parseInt($('#buyTotalAmount').text());
		    var itemTotal;
		    if (upordown == 'up' && !((total + cost) > munny)) {
		        value++;
		        total += cost;
		    } else if (upordown == 'down') {
		        if (value <= 0)
		            value = 0;
		        else {
		            value--;
		            total -= cost;
		        }
		    }
		    itemTotal = value * cost;
		    $(str).val(value);
		    $(str2).text(itemTotal);
		    $('#buyTotalAmount').text(total);
		};

		//icons from http://game-icons.net
		var selectIcon = function(type) {
		    switch (type) {
		        case "ing":
		            return "<img src='img/tree-branch.png'>";
		        default:
		            return "<img src='img/locked-chest.png'>";
		    }
		};

		$("#IngBuyButton").click(function() {
		    var total = parseInt($('#buyTotalAmount').text());
		    subMunny(total);
		    $('#buyTotalAmount').text(0);
		    for (let i of ingShopCat) {
		        var str = '#' + i.id + 'BM input';
		        var str2 = '#' + i.id + 'BM .buyItemTotal';
		        var itemTot = parseInt($(str).val());
		        if (itemTot > 0) {
		            addInv(i);
		        }
		        $(str).val(0);
		        $(str2).text(0);
		    }
		});

		var resetIngBuyMenu = function() {
		    $('#buyTotalAmount').text(0);
		    for (let i of ingShopCat) {
		        var str = '#' + i.id + 'BM input';
		        var str2 = '#' + i.id + 'BM .buyItemTotal';
		        $(str).val(0);
		        $(str2).text(0);
		    }
		};
		
		/* Journal */
		var openJournal = function(){
			$("#journal").css("width", "100%");
			resetInvMenu();
			loadInvMenu();
			loadEquipment();
		};

		var closeJournal = function(){
			$("#journal").css("width", "0%");
		};
		
		var openTab = function(name) {
			var i, tabcontent, tablinks;
			tabcontent = document.getElementsByClassName("tabcontent");
			for (i = 0; i < tabcontent.length; i++) {
				tabcontent[i].style.display = "none";
			}
			tablinks = document.getElementsByClassName("tablinks");
			for (i = 0; i < tablinks.length; i++) {
				tablinks[i].className = tablinks[i].className.replace(" active", "");
			}
			document.getElementById(name).style.display = "block";
			//evt.currentTarget.className += " active";
		}
		
		/* Journal Inventory */
		
		var loadInvMenu = function() {
			$("#invTable").append("<tr><th>Name</th><th>Value</th><th>Amount</th><th>Total Value</th></tr>")
		    for (let i of inventory) {	
				var total = i.invCount * i.value;
		        $("#invTable").append('<tr id=' + i.id + 'IM><td>' + selectIcon(i.type) + "  " + i.name + '</td><td>' + i.value + '</td><td>'+i.invCount+'</td><td>'+ total +'</td><td><button class="myBtn" id="jInvDrop" onclick="javascript:jInvDrop('+ i.id +')">Drop</button></td></tr>');
		    }
		}

		var resetInvMenu = function() {
			$("#invTable").empty();
		}
		
		var jInvDrop = function(item){
			dropItem(item);
			resetInvMenu();
			loadInvMenu();
		}
		
		/* Journal Equipment*/
		var equip = function(id){
			console.log("equipping,,");
			var sel, sel2, style1, style2, class_;
			for(let i of equipment){
				if(i.id == id){
					equipped.push(i);
					switch(i.subType){
						case "hat": 
							sel = "#hatE"; 
							sel2 = "#playerHat";
							break;
						case "shirt": 
							sel = "#shirtE"; 
							sel2 = "#playerShirt";
							style1= "width:90px; height:80px";
							style2 = "bottom: 90px;";
							class_ = "secondLayer";
							break;
						case "pants": 
							sel = "#pantsE";
							sel2 = "#playerPants";  
							break;
						case "skirt": 
							sel = "#pantsE";
							sel2 = "#playerPants"; 
							style1= "width:90px; height:80px; padding-top: 30px;";
							style2 = "bottom: 40px;";
							class_ = "firstLayer";
							break;
						case "handR": 
							sel = "#handRE"; 
							sel2 = "#playerHandR"; 
							break;
						case "handL": 
							sel = "#handLE";
							sel2 = "#playerHandL";  
							break;
						case "shoes":
							sel = "#shoesE"; 
							sel2 = "#playerShoes";
							break;
						default: console.log("Error: No equipable subtype for item");
					}
					console.log("sel= "+sel);
					$(sel).empty();
					$(sel2).empty();
					$(sel).append("<img src="+i.sprite+" style='align:center; "+style1+"'>");	
					$(sel2).append("<img src="+i.sprite+" class ='"+class_+"' style='"+style2+" position: absolute;'>");	
					loadAvatar();
				}
			}
		}
		
		var loadAvatar = function(){
			$("#playerAvatar").empty();
			var shirt = $("#playerShirt").clone();
			shirt.find('*').removeAttr('style');
			shirt.prop('id', 'avatarShirt' );
			$("#playerAvatar").append("<img src='img/playerBase.png'>");
			$("#playerAvatar").append(shirt);
		}
		

		
		var loadEquipment = function(){
			var eLength = equipment.length;
			$('#equipmentChest').children().each(function(index, item) {
				if(eLength == 0)
					return;
				console.log(this);
				$(this).empty();
				$(this).append("<img src="+equipment[eLength - 1].sprite+" class= '"+equipment[eLength - 1].subType+"' onclick='equip("+(equipment[eLength - 1].id)+"); equipDisplayInfo("+(equipment[eLength - 1].id)+");' onmouseover='equipDisplayInfo("+(equipment[eLength - 1].id)+");'>");	
				eLength--;
			});
		};
		
		var equipDisplayInfo = function(id){
			for(let i of equipment){
				if(i.id == id){
					$('#equipInfo').empty();
					$('#equipInfo').append("<span class='cap'>"+i.name + "<br> value: "+i.value + " mun</span><br>"+ i.desc);
				}
			}
		};
		
		/* Talking */
		var toggleTalk = function(actor){
			$(".bottomOfScreen").attr('id', ($(".bottomOfScreen").attr('id') == 'bottomText' ? 'talkingText' : 'bottomText'));
			$("#playerAvatar").toggle();
			$("#resizeBtn").toggle();
			$("#nameBox").toggle();
			console.log("toggle talk");
			if(!talking){
				talking = true;
				$("#nameBoxText").text(actor.name);
				$(".textBox").text(actor.startState.pages[0]);
				$("#npcCutOut").append("<img src='"+actor.cutOut+"'>");
				$(".action ul").empty();
				if(actor.startState.pages.length > 1)
					addAction("next", "Next");
				$(".textBox").css("font-size", "26px");
				$(".textBox").css("bottom", "");
				$(".textBox").css("top", "");
			}
			else{
				talking = false;
				$("#npcCutOut").empty();
				$(".textBox").css("font-size", "18px");
				if(!resizeToggle)
					$(".textBox").css("bottom", "10px");
				else
					$(".textBox").css("top", "10px");
				refreshRoom(null);
				scrollTextUp();
			}
		}
		
		var turnPageFwd = function(){
			if(currentPage < state.pages.length){
				currentPage++;
				$(".textBox").text(state.pages[currentPage]);
			}
			if(currentPage == state.pages.length - 1){
				removeAction("next");
				addAction("endConvo", "Goodbye");
			}
			else if(currentPage == 1){
				addAction("prev", "Previous");
				removeAction("next");
				addAction("next", "Next");
			}
		}
		
		var turnPagePre = function(){
			if(currentPage > 0){
				currentPage--;
				$(".textBox").text(state.pages[currentPage]);
			}
			if(currentPage == 0){
				removeAction("prev");
			}
			else if(currentPage == state.pages.length - 2){
				addAction("next", "Next");
			}
		}
		
		/* Actions */
		var lookAround = function() {
		    addText(currentRoom.desc);
		    displayItemsInRoom();
		};
		
		$(".inv ul").find("a").on("click", function(event){
			scrollText();
		});

		/* Next Click */
		$(".action").on("click", "#next", function(event) {
			turnPageFwd();
			console.log(currentPage);
		});
		
		/* Previous Click */
		$(".action").on("click", "#prev", function(event) {
			turnPagePre();
			console.log(currentPage);
		});
		
		/* EndConvo Click */
		$(".action").on("click", "#endConvo", function(event) {
			toggleTalk();
		});
		
		/* Resize Click */
		$("#resizeBtn").on("click", function(event) {
			 $(this).toggleClass('glyphicon-resize-full').toggleClass('glyphicon-resize-small');
			if(!resizeToggle){
				$(".bottomOfScreen").css("top", "25%");
				$(".textBox").css("top", "10px");
				$(".textBox").css("bottom", "");
				resizeToggle = true;
			}
			else{
				$(".bottomOfScreen").css("top", "");
				$(".textBox").css("bottom", "10px");
				$(".textBox").css("top", "");
				resizeToggle = false;
			}
		});

		/* Exit Click */
		$(".exit").on("click", "li", function(event) {
			if(!talking){
				var oldRoom = currentRoom;
				for (let e of currentRoom.exits) {
					if (e.dir == this.id) {
						currentRoom = e.nextRoom;
						if (e.nextRoom == null) {
							console.log(e.dir);
							console.log("room is null");
						} else {
							if (currentRoom != oldRoom) {
								if (e.exitMsg != null)
									changeRoom(e);
								else
									changeRoom();
							}
						}
					}
				}
			}
		});

		/*action click */
		$(".action").on("click", function(event) {
		    scrollText();
		});

		/* Look Click */
		$(".action").on("click", "#look", function(event) {
		    lookAround();
		});

		/* Take Click */
		$(".action").on("click", "#take", function(event) {
		    $(".action ul").empty();
		    for (let i of currentRoom.takeableItems) {
		        $(".action ul").append('<li class = "takeable" id="' + i.id + '"><a href="#">' + i.name + '</a></li>');
		    }
		    $(".action ul").append('<li id="back"><button type="image" src="img/parch.png" class = "btn-custom" class="btn ">Back</button></li>');
		});

		/* Take.Item Click */
		$(".action").on("click", "li.takeable", function(event) {
		    takeTurn();
		    for (let i of currentRoom.takeableItems) {
		        if (i.id == this.id) {
		            takeItem(i);
		        }
		    }
		    if (currentRoom.takeableItems.length == 0) {
		        menuBack();
		    }
		});

		/* Take.Back Click */
		$(".action").on("click", "#back", function(event) {
		    menuBack();
		});
		
		/* Shop Click */
		$(".action").on("click", "#shop", function(event) {
		    ingShopInit ();
			$("ingShopBackgound")
			$("#ingShop").toggle();
			$("#roam").toggle();
		});

		//test button
		$("button").click(function() {
		    //var win = window.open();
		    //win.document.write(inventory[0].name) ;
		    //$( "#roam" ).toggle();
		    //$( "#ingShop" ).toggle();
		    //win.document.write(inventory[0].name) ;
		    //win.document.close();
		});
		
		var scrollText = function(){
			var psconsole = $('.textBox');
			if(psconsole.length){
				psconsole.scrollTop(psconsole[0].scrollHeight - psconsole.height());
				console.log("down");
			}
		};
		
		var scrollTextUp = function(){
			var psconsole = $('.textBox');
			if(psconsole.length){
				psconsole.scrollTop(0);
				console.log("up");
			}
		};
		
		

		/* ToolTip Examine Click */
		var examine = function(item) {
		    console.log('worked');
		    for (let i of inventory) {
		        if (i.id == item) {
		            addText("You remove the " + i.name + " from your bag and examine it. " + i.desc);
					scrollText();
		        }
		    }

		}
		/* New Game Name Enter Click*/
		$("#nameEnter").on("click", function(event) {
		if($('#nameterm').val() != ''){
				name = $("#nameterm").val();
				console.log(name);
				$("#startNewGame").toggle();
				roamInit();
			    $("#roam").toggle();
			}
			else{
				$("#nameterm").attr("placeholder", "Please enter a name");
			}
		});
		
		$('#nameterm').keypress(function (e) {
			var key = e.which;
			if(key == 13) {
				if($('#nameterm').val() != ''){
					name = $("#nameterm").val();
					console.log(name);
					$("#startNewGame").toggle();
					roamInit();
					$("#roam").toggle();
				}
				else{
					$("#nameterm").attr("placeholder", "Please enter a name");
				}
			}
		});   
		
		/* New Game Click */
		$("#NewGameBtn").on("click", function(event) {
			$("#mainMenu").toggle();
		    $("#startNewGame").toggle();
		});

			$('body').hover(function(event) {
					console.log("hovering");
					//find the element that dispatched the event
					var target = $(event.target);
					//make sure that the element that dispatched the event was NOT the .del-btn
					if (!target.hasClass('pop')) {
						//if ANY element on the body dispatched the event other than the .del-btn
						//hide any open popovers
						$('.pop').popover('hide');
					}
		    });
			
		/* Getters */
		var getName = function(){
			return name;
		};
		
		var get = function(obj){
			return obj;
		}
		
		var init = function() {
			// Get the element with id="defaultOpen" and click on it
			document.getElementById("defaultOpen").click();
		    ingShopCat = [key, comb];
		    $("#ingShop").toggle();
			$("#roam").toggle();
			//$("#mainMenu").toggle();
			$("#startNewGame").toggle();
			$("#nameBox").toggle();
			$(".Playername").text(name);
			state = AierithIntro;
		    addMunny(100);
		    currentRoom = bedRoom;
		    changeRoom();
			currentRoom.hasSeen = false;
			equipment.push(brownShirt);
			equipment.push(blueSkirt);
			toggleTalk(Aierith);
		}
		
		$('body').keyup(function(e){
			if(e.keyCode == 13){
				$(this).trigger("enterKey");
			}
		});
		var roamInit = function() {
			$(".Playername").text(name);
		}
		var ingShopInit = function() {
		    resetIngBuyMenu();
		    loadShopMenu();
		}

		/********** Objects ***********/
		/* items */
		var key = new Item("key", 1, "An old key.", "A small glinting object lays on the ground.", 2, "ing", null, null, true, true);
		var comb = new Item("comb", 2, "Without this you'd always have a bad hairday.", "A small comb lays on the ground", 4, "none", null,  null, true, true);
		var brownShirt = new Item("brown shirt", 3, "A floofy brown shirt", "A brown fluffy item lies scrunched up on the ground.", 10, "equip", "shirt","img/shirtBrown.png", true, true);
		var blueSkirt= new Item("blue skirt", 4, "A short blue skirt.", "A blue fluffy item lies scrunched up on the ground.", 15, "equip", "skirt","img/skirtBlue.png", true, true);
		/* rooms */
		//west wing rooms
		var bedRoom = new Room("Bedroom", "img/bedroom.png", "Your new mentor gives you a gentle smile as she turns to leave you to get settled in your new room. Suddenly exhausted you take a seat on your bed. "
			+"Waves of tension flow down your body. Sure you had known a lot would be expected out of you, working at the royal castle, but you hadn't expected to already be in charge of so much. Your right hand idly plays with your "
			+"bed coverings, fingers slowly kneading into them like a kitten searching for milk. This was life, the royality owned the commoners. They could only hope that their ruler's guidance lead to prosperity. You look around your room with a sigh. "
			+"Its true that its no smaller than what you use to back home, you did after all share a room of simular size with your sister, but its feels empty and lonely. "
			+"The bed is covered in a plain spread with white sheets and a brown thin looking blanket. Your new desk is unadorned, just waiting to be covered in knick nacks and work forms. You spend the rest of the day unpacking your megar belongings and end the day with "
			+"with a bath in your private wooden wash basin in the corner of the room. You apperciate the plain dividor hiding you from the view of the door.",
		"Your bedroom is on the small side but at least its been furnished with a desk and a bed along the east wall. In the opposite corner a plain dividor hides a wooden wash basin. A door to the north leads out into the hallway.");
		var hallway = new Room("Hallway",  "img/hallway.jpg", null, "A narrow hallway lined with doors");
		var closet = new Room("Closet",  "img/closet.jpg", null, "A walk in closet with plenty of room tp hang up clothes. The door out is to the northEast.");
		//east wing rooms
		//lobby rooms
		var platform = new Room("Platform", "img/platform.jpg", null, "You stand on a  platform overlooking the first floor of the castle. To the west there is the door leading to the west wing and to the east is the door to the east wing. Below you are stairs going down.");
		var lobby = new Room("Lobby", "img/lobby.jpg", null, "This room could easily fit hundered people all scurring to complete one task or another. It was rare to see any royalty come this way as this is considered to be an extension of the castle workers living quarters. " +
		    " It would be hard to complain though. Rays of sunlight stream through the high widows and sometimes small birds would fly in, chirping a merry song. The smell of freshly made food could be smelt from the nearby kitchen.", null, null, "This room could easily fit hundered people all scurring to complete one task or another. It was rare to see any royalty come this way as this is considered to be an extension of the castle workers living quarters. " +
		    " It would be hard to complain though. The hall looked breathtaking at night. Streams of cool moonlight filter in through the widows, while colorful laterns have been lit along the walls bathing the hall in a myriad of colors.");
		var shop = new Room("Your Shop",  "img/shop.png", null, "A sparse shop with cabinets lined agianst the back wall holding your products. In front of the cabinets is a bar with comfy looking stools for patrons to sit at. Going through the employees only door will lead into the inner bar area while the door to the east leads out. ");
		var ingredientshop = new Room("Ingredient Shop",  "img/ingShop.jpg", null, "A sparse shop with cabinets lined agianst the back wall holding your products. In front of the cabinets is a bar with comfy looking stools for patrons to sit at.");
		/* exits */
		bedRoom.addExits([new Exit(N, hallway), new Exit(NW, closet)]);
		hallway.addExits([new Exit("Bedroom", bedRoom), new Exit(E, platform)]);
		closet.addExits([new Exit(NE, bedRoom)]);
		platform.addExits([new Exit(W, hallway), new Exit("Down", lobby, "You walk down the stairway and into the lobby.")]);
		lobby.addExits([new Exit("Up", platform, "You walk up the staircase and onto the platform."), new Exit(shop.name, shop), new Exit("Ingredient Shop", ingredientshop)]);
		lobby.addExits([new Exit("Up", platform, "You walk up the staircase and onto the platform."), new Exit(shop.name, shop), new Exit("Ingredient Shop", ingredientshop)]);
		shop.addExits([new Exit("Employees Only Door", null), new Exit("Out", lobby)]);
		ingredientshop.addExits([ new Exit("Out", lobby) ])
		
		
		
		/* Actors */
		var AierithIntro = new State(
		["So you must be the famous "+name+". I am Aierith, the apothecary master of the castle. I am in charge of the apothecary room and making sure all the royal medicine needs are met. ",
		 "As you can imagine this makes it diffcult to also attend to the needs of the workers and other residents of the castle. Thats where you come in. You will be my assistant, of sorts. ",
		 "Don't look at me like that. I may of have heard good things about you but you just got here. You have to prove yourself first if you want full the privileges of the station.",
		 "For now you will start off with the rank of apprentice. While the royal members do not worry about the expenses of the medicine, as the house settles those accounts, the other residents will pay you directly.",
		 "To handle these operations you will be provided with a shop to operate out of. You will be fully responsible for your store, including making the medicines to stock it with and obtaining the herbs for the medicines themselves. ",
		 "You will get paid a weekly stipend, but if you do not meet a certian quato of sales your pay will be docked. In the same return if you have a particularly good week you may recive a bonus. ",
		 "You will also get to keep the coin from your patrons minus a tax deduction, of course. Once you are of a suffiecent rank you may even receive requests from nobels or even members of the royal family. Missives for these will be delivered to you at daybreak.",
		 "You are not required to complete these, but they pay a higher amount and if you fail they may be required to seek help else where. This may inevitably hurt your reputation and negativly impact your status. ",
		 "With enough negative reports I may be forced to lower your rank. I know that it may be a lot to take in right now but I am sure you will get the hang of it."
		 ])
		var Aierith = new Actor("Aierith", AierithIntro, "img/Aierith.png");

		/********** Main ***********/

		init();

		addInv(comb);
		addInv(key);
		addInv(key);


        </script>
</body>

</html>